import{L as i,s as T,i as E,a as S}from"./leaflet-vendor-Do2TvcFZ.js";import{d as $,r as v,K as w,o as F,m as Z,b as y,e as x,n as G,g as b,h as n,t as I,x as N,f as z}from"./vue-vendor-DmxhFomr.js";import{_ as P}from"./auth-a3bL7d2J.js";const j={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg z-10"},O={key:1,class:"absolute inset-0 flex items-center justify-center bg-red-50 dark:bg-red-900/20 rounded-lg z-10"},R={class:"text-center"},H={class:"text-red-600 dark:text-red-400 text-sm"},K={class:"absolute top-2 right-2 z-[1000]"},W={class:"absolute bottom-2 left-2 z-[1000]"},Y=$({__name:"map",props:{height:{default:"400px"},width:{default:"100%"},center:{default:()=>[40.7128,-74.006]},zoom:{default:13},markers:{default:()=>[]},showUserLocation:{type:Boolean,default:!0},enableClustering:{type:Boolean,default:!1},enableSearch:{type:Boolean,default:!1},class:{default:""}},emits:["markerClick","mapClick","mapReady","locationFound","locationError"],setup(C,{expose:L,emit:M}){delete i.Icon.Default.prototype._getIconUrl,i.Icon.Default.mergeOptions({iconRetinaUrl:S,iconUrl:E,shadowUrl:T});const a=C,c=M,g=v();let o=null,l=null,s=null;const m=v(!0),h=v(null),f=(e="default")=>{const t={clinic:{iconUrl:"data:image/svg+xml;base64,"+btoa(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#2563eb" width="32" height="32">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    <path d="M10 8h1v1h2V8h1v4h-1v-1h-2v1h-1V8z" fill="white"/>
                </svg>
            `),iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]},emergency:{iconUrl:"data:image/svg+xml;base64,"+btoa(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#dc2626" width="32" height="32">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    <path d="M10 8h1v1h2V8h1v4h-1v-1h-2v1h-1V8z" fill="white"/>
                </svg>
            `),iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]},user:{iconUrl:"data:image/svg+xml;base64,"+btoa(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#16a34a" width="32" height="32">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    <circle cx="12" cy="9" r="1.5" fill="white"/>
                </svg>
            `),iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]},default:{iconUrl:"data:image/svg+xml;base64,"+btoa(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#6b7280" width="32" height="32">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
            `),iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}};return i.icon(t[e]||t.default)},_=()=>{if(g.value)try{o=i.map(g.value,{center:a.center,zoom:a.zoom,zoomControl:!0}),i.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(o),s=i.layerGroup().addTo(o),k(),a.showUserLocation&&U(),o.on("click",e=>{c("mapClick",e)}),c("mapReady",o),m.value=!1}catch(e){console.error("Error initializing map:",e),h.value="Failed to initialize map",m.value=!1}},k=()=>{if(!o||!s)return;if(s.clearLayers(),a.markers.length===0){console.log("No markers to display - this is normal when filters result in no matches");return}console.log("Adding",a.markers.length,"markers to map");const e=[];a.markers.forEach(t=>{try{const r=i.marker([t.lat,t.lng],{icon:f(t.type)});r.markerData=t;const u=`
                <div class="p-2">
                    <h3 class="font-semibold text-sm mb-1">${t.title}</h3>
                    ${t.description?`<p class="text-xs text-gray-600">${t.description}</p>`:""}
                </div>
            `;r.bindPopup(u),r.on("click",()=>{c("markerClick",t)}),e.push(r)}catch(r){console.warn("Error creating marker:",r,t)}}),e.length>0&&(e.forEach(t=>s.addLayer(t)),console.log(`Added ${e.length} markers to map`),B(e))},B=e=>{!o||e.length===0||m.value&&setTimeout(()=>{try{const r=new i.FeatureGroup(e).getBounds();if(r.isValid()){if(r.getNorthEast().distanceTo(r.getSouthWest())>50)o.fitBounds(r.pad(.1),{maxZoom:16,animate:!0,duration:.5});else if(e.length===1){const p=e[0].markerData,V=o.getZoom();o.setView([p.lat,p.lng],Math.max(V,14),{animate:!0,duration:.5})}}}catch(t){console.warn("Error fitting bounds:",t)}},100)},A=()=>{s&&s.clearLayers()},U=()=>{if(!navigator.geolocation){console.warn("Geolocation is not supported by this browser");return}navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:r}=e.coords;o&&(l&&o.removeLayer(l),l=i.marker([t,r],{icon:f("user")}).addTo(o),l.bindPopup('<div class="p-2"><strong>Your Location</strong></div>'),a.markers.length===0&&o.setView([t,r],a.zoom)),c("locationFound",e)},e=>{console.warn("Error getting user location:",e.message),c("locationError",e)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})};let d=null;return w(()=>a.markers,(e,t)=>{!o||!s||(d&&clearTimeout(d),d=setTimeout(()=>{e&&(console.log("Updating markers:",{newCount:e.length,layerCount:s.getLayers().length}),k())},50))},{deep:!0,immediate:!1}),w(()=>a.center,e=>{o&&e&&o.setView(e,a.zoom)}),w(()=>a.zoom,e=>{o&&e&&o.setZoom(e)}),F(()=>{setTimeout(_,100)}),Z(()=>{d&&clearTimeout(d),s&&(s.clearLayers(),s=null),l&&o&&(o.removeLayer(l),l=null),o&&(o.remove(),o=null)}),L({getMap:()=>o,getMarkerLayer:()=>s,addMarker:e=>{if(o&&s){const t=i.marker([e.lat,e.lng],{icon:f(e.type)});t.markerData=e;const r=`
                <div class="p-2">
                    <h3 class="font-semibold text-sm mb-1">${e.title}</h3>
                    ${e.description?`<p class="text-xs text-gray-600">${e.description}</p>`:""}
                </div>
            `;t.bindPopup(r),t.on("click",()=>c("markerClick",e)),s.addLayer(t)}},removeMarker:e=>{s&&s.eachLayer(t=>{const r=t;r.markerData?.id===e&&s.removeLayer(r)})},clearAllMarkers:A,centerOnLocation:(e,t,r)=>{o&&o.setView([e,t],r||a.zoom)},fitBounds:e=>{if(o&&s){const t=s.getLayers();if(t.length>0){const u=new i.FeatureGroup(t).getBounds();if(u.isValid()){const p={padding:[e?.padding||20,e?.padding||20],maxZoom:e?.maxZoom||16,animate:e?.animate!==!1,duration:.5};o.fitBounds(u,p)}}}}}),(e,t)=>(x(),y("div",{class:G(["relative",a.class])},[m.value?(x(),y("div",j,[...t[0]||(t[0]=[n("div",{class:"flex items-center space-x-2 text-gray-600 dark:text-gray-400"},[n("svg",{class:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),n("span",null,"Loading map...")],-1)])])):b("",!0),h.value?(x(),y("div",O,[n("div",R,[t[1]||(t[1]=n("div",{class:"text-red-600 dark:text-red-400 mb-2"},[n("svg",{class:"h-12 w-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),n("p",H,I(h.value),1)])])):b("",!0),n("div",{ref_key:"mapContainer",ref:g,style:N({height:a.height,width:a.width}),class:"rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"},null,4),n("div",K,[z(e.$slots,"controls",{},void 0,!0)]),n("div",W,[z(e.$slots,"legend",{},void 0,!0)])],2))}}),X=P(Y,[["__scopeId","data-v-e531231e"]]);export{X as M};
