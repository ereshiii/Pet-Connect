import{a0 as J,a1 as W,a2 as X,K as Y,M as Z,O as ee,L as te,a as T,N as se,R as ae,W as oe,X as le,Y as re,G as ne,H as ie,I as ce,S as ue}from"./ui-components-Dj0vw2vK.js";import{r as de,s as fe,q as ve,a as pe,c as me}from"./index-U6g8M1fB.js";import{f as N}from"./inertia-vendor-BXJnWAhq.js";import{_ as ye,az as _e,af as he,N as be,R as we,aA as ge,ae as K,m as xe,ar as ke}from"./lucide-vendor-BUHJwLVO.js";import{d as D,c as E,a as _,e as s,u as e,w as o,i as a,j as u,t as k,h as t,b as n,F as y,k as S,r as h,o as Ce,g as $e,l as Se,z as O,n as Re,U as I,aw as Fe,ax as Te,ay as je,K as Ae}from"./vue-vendor-DmxhFomr.js";import{a as Ee}from"./auth-a3bL7d2J.js";const Ve={class:"list-inside list-disc text-sm"},H=D({__name:"AlertError",props:{errors:{},title:{default:"Something went wrong."}},setup(d){const l=d,i=E(()=>Array.from(new Set(l.errors)));return(f,c)=>(s(),_(e(J),{variant:"destructive"},{default:o(()=>[a(e(ye),{class:"size-4"}),a(e(W),null,{default:o(()=>[u(k(d.title),1)]),_:1}),a(e(X),null,{default:o(()=>[t("ul",Ve,[(s(!0),n(y,null,S(i.value,(m,b)=>(s(),n("li",{key:b},k(m),1))),128))])]),_:1})]),_:1}))}}),q=async d=>{const l=await fetch(d,{headers:{Accept:"application/json"}});if(!l.ok)throw new Error(`Failed to fetch: ${l.status}`);return l.json()},F=h([]),C=h(null),$=h(null),A=h([]),ze=E(()=>$.value!==null&&C.value!==null),Q=()=>{const d=async()=>{try{const{svg:g}=await q(ve.url());$.value=g}catch{F.value.push("Failed to fetch QR code"),$.value=null}},l=async()=>{try{const{secretKey:g}=await q(fe.url());C.value=g}catch{F.value.push("Failed to fetch a setup key"),C.value=null}},i=()=>{C.value=null,$.value=null,f()},f=()=>{F.value=[]};return{qrCodeSvg:$,manualSetupKey:C,recoveryCodesList:A,errors:F,hasSetupData:ze,clearSetupData:i,clearErrors:f,clearTwoFactorAuthData:()=>{i(),f(),A.value=[]},fetchQrCode:d,fetchSetupKey:l,fetchSetupData:async()=>{try{f(),await Promise.all([d(),l()])}catch{$.value=null,C.value=null}},fetchRecoveryCodes:async()=>{try{f(),A.value=await q(de.url())}catch{F.value.push("Failed to fetch recovery codes"),A.value=[]}}}},qe={class:"flex flex-col gap-3 select-none sm:flex-row sm:items-center sm:justify-between"},De={key:0,class:"mt-6"},Me={key:1,class:"mt-3 space-y-3"},Le={key:0,class:"space-y-2"},ct=D({__name:"TwoFactorRecoveryCodes",setup(d){const{recoveryCodesList:l,fetchRecoveryCodes:i,errors:f}=Q(),c=h(!1),m=h(null),b=async()=>{!c.value&&!l.value.length&&await i(),c.value=!c.value,c.value&&(await I(),m.value?.scrollIntoView({behavior:"smooth"}))};return Ce(async()=>{l.value.length||await i()}),(g,v)=>(s(),_(e(Y),{class:"w-full"},{default:o(()=>[a(e(te),null,{default:o(()=>[a(e(Z),{class:"flex gap-3"},{default:o(()=>[a(e(_e),{class:"size-4"}),v[0]||(v[0]=u("2FA Recovery Codes ",-1))]),_:1}),a(e(ee),null,{default:o(()=>[...v[1]||(v[1]=[u(" Recovery codes let you regain access if you lose your 2FA device. Store them in a secure password manager. ",-1)])]),_:1})]),_:1}),a(e(se),null,{default:o(()=>[t("div",qe,[a(e(T),{onClick:b,class:"w-fit"},{default:o(()=>[(s(),_(Se(c.value?e(he):e(be)),{class:"size-4"})),u(" "+k(c.value?"Hide":"View")+" Recovery Codes ",1)]),_:1}),c.value&&e(l).length?(s(),_(e(N),O({key:0},e(pe).form(),{method:"post",options:{preserveScroll:!0},onSuccess:e(i)}),{default:o(({processing:w})=>[a(e(T),{variant:"secondary",type:"submit",disabled:w},{default:o(()=>[a(e(we)),v[2]||(v[2]=u(" Regenerate Codes ",-1))]),_:1},8,["disabled"])]),_:1},16,["onSuccess"])):$e("",!0)]),t("div",{class:Re(["relative overflow-hidden transition-all duration-300",c.value?"h-auto opacity-100":"h-0 opacity-0"])},[e(f)?.length?(s(),n("div",De,[a(H,{errors:e(f)},null,8,["errors"])])):(s(),n("div",Me,[t("div",{ref_key:"recoveryCodeSectionRef",ref:m,class:"grid gap-1 rounded-lg bg-muted p-4 font-mono text-sm"},[e(l).length?(s(!0),n(y,{key:1},S(e(l),(w,x)=>(s(),n("div",{key:x},k(w),1))),128)):(s(),n("div",Le,[(s(),n(y,null,S(8,w=>t("div",{key:w,class:"h-4 animate-pulse rounded bg-muted-foreground/20"})),64))]))],512),v[3]||(v[3]=t("p",{class:"text-xs text-muted-foreground select-none"},[u(" Each recovery code can be used once to access your account and will be removed after use. If you need more, click "),t("span",{class:"font-bold"},"Regenerate Codes"),u(" above. ")],-1))]))],2)]),_:1})]),_:1}))}}),Be={class:"mb-3 w-auto rounded-full border border-border bg-card p-0.5 shadow-sm"},Ke={class:"relative overflow-hidden rounded-full border border-border bg-muted p-2.5"},Ne={class:"absolute inset-0 grid grid-cols-5 opacity-50"},Oe={class:"absolute inset-0 grid grid-rows-5 opacity-50"},Ie={class:"relative flex w-auto flex-col items-center justify-center space-y-5"},He={class:"relative mx-auto flex max-w-md items-center overflow-hidden"},Qe={class:"relative mx-auto aspect-square w-64 overflow-hidden rounded-lg border border-border"},Ue={key:0,class:"absolute inset-0 z-10 flex aspect-square h-auto w-full animate-pulse items-center justify-center bg-background"},Pe={key:1,class:"relative z-10 overflow-hidden border p-5"},Ge=["innerHTML"],Je={class:"flex w-full items-center space-x-5"},We={class:"flex w-full items-center justify-center space-x-2"},Xe={class:"flex w-full items-stretch overflow-hidden rounded-xl border border-border"},Ye={key:0,class:"flex h-full w-full items-center justify-center bg-muted p-3"},Ze=["value"],et=["value"],tt={class:"flex w-full flex-col items-center justify-center space-y-3 py-2"},st={class:"flex w-full items-center space-x-5"},ut=D({__name:"TwoFactorSetupModal",props:Fe({requiresConfirmation:{type:Boolean},twoFactorEnabled:{type:Boolean}},{isOpen:{type:Boolean},isOpenModifiers:{}}),emits:["update:isOpen"],setup(d){const l=d,i=Te(d,"isOpen"),{copy:f,copied:c}=je(),{qrCodeSvg:m,manualSetupKey:b,clearSetupData:g,fetchSetupData:v,errors:w}=Q(),x=h(!1),R=h([]),M=E(()=>R.value.join("")),L=h(null),V=E(()=>l.twoFactorEnabled?{title:"Two-Factor Authentication Enabled",description:"Two-factor authentication is now enabled. Scan the QR code or enter the setup key in your authenticator app.",buttonText:"Close"}:x.value?{title:"Verify Authentication Code",description:"Enter the 6-digit code from your authenticator app",buttonText:"Continue"}:{title:"Enable Two-Factor Authentication",description:"To finish enabling two-factor authentication, scan the QR code or enter the setup key in your authenticator app",buttonText:"Continue"}),U=()=>{if(l.requiresConfirmation){x.value=!0,I(()=>{L.value?.querySelector("input")?.focus()});return}g(),i.value=!1},P=()=>{l.twoFactorEnabled&&g(),x.value=!1,R.value=[]};return Ae(()=>i.value,async B=>{if(!B){P();return}m.value||await v()}),(B,r)=>(s(),_(e(ae),{open:i.value,"onUpdate:open":r[5]||(r[5]=p=>i.value=p)},{default:o(()=>[a(e(ue),{class:"sm:max-w-md"},{default:o(()=>[a(e(oe),{class:"flex items-center justify-center"},{default:o(()=>[t("div",Be,[t("div",Ke,[t("div",Ne,[(s(),n(y,null,S(5,p=>t("div",{key:`col-${p}`,class:"border-r border-border last:border-r-0"})),64))]),t("div",Oe,[(s(),n(y,null,S(5,p=>t("div",{key:`row-${p}`,class:"border-b border-border last:border-b-0"})),64))]),a(e(ge),{class:"relative z-20 size-6 text-foreground"})])]),a(e(le),null,{default:o(()=>[u(k(V.value.title),1)]),_:1}),a(e(re),{class:"text-center"},{default:o(()=>[u(k(V.value.description),1)]),_:1})]),_:1}),t("div",Ie,[x.value?(s(),_(e(N),O({key:1},e(me).form(),{"reset-on-error":"",onFinish:r[3]||(r[3]=p=>R.value=[]),onSuccess:r[4]||(r[4]=p=>i.value=!1)}),{default:o(({errors:p,processing:z})=>[t("input",{type:"hidden",name:"code",value:M.value},null,8,et),t("div",{ref_key:"pinInputContainerRef",ref:L,class:"relative w-full space-y-3"},[t("div",tt,[a(e(ne),{id:"otp",placeholder:"â—‹",modelValue:R.value,"onUpdate:modelValue":r[1]||(r[1]=j=>R.value=j),type:"number",otp:""},{default:o(()=>[a(e(ie),null,{default:o(()=>[(s(),n(y,null,S(6,(j,G)=>a(e(ce),{autofocus:"",key:j,index:G,disabled:z},null,8,["index","disabled"])),64))]),_:2},1024)]),_:2},1032,["modelValue"]),a(Ee,{message:p?.confirmTwoFactorAuthentication?.code},null,8,["message"])]),t("div",st,[a(e(T),{type:"button",variant:"outline",class:"w-auto flex-1",onClick:r[2]||(r[2]=j=>x.value=!1),disabled:z},{default:o(()=>[...r[7]||(r[7]=[u(" Back ",-1)])]),_:1},8,["disabled"]),a(e(T),{type:"submit",class:"w-auto flex-1",disabled:z||M.value.length<6},{default:o(()=>[...r[8]||(r[8]=[u(" Confirm ",-1)])]),_:1},8,["disabled"])])],512)]),_:1},16)):(s(),n(y,{key:0},[e(w)?.length?(s(),_(H,{key:0,errors:e(w)},null,8,["errors"])):(s(),n(y,{key:1},[t("div",He,[t("div",Qe,[e(m)?(s(),n("div",Pe,[t("div",{innerHTML:e(m),class:"flex aspect-square size-full items-center justify-center"},null,8,Ge)])):(s(),n("div",Ue,[a(e(K),{class:"size-6 animate-spin"})]))])]),t("div",Je,[a(e(T),{class:"w-full",onClick:U},{default:o(()=>[u(k(V.value.buttonText),1)]),_:1})]),r[6]||(r[6]=t("div",{class:"relative flex w-full items-center justify-center"},[t("div",{class:"absolute inset-0 top-1/2 h-px w-full bg-border"}),t("span",{class:"relative bg-card px-2 py-1"},"or, enter the code manually")],-1)),t("div",We,[t("div",Xe,[e(b)?(s(),n(y,{key:1},[t("input",{type:"text",readonly:"",value:e(b),class:"h-full w-full bg-background p-3 text-foreground"},null,8,Ze),t("button",{onClick:r[0]||(r[0]=p=>e(f)(e(b)||"")),class:"relative block h-auto border-l border-border px-3 hover:bg-muted"},[e(c)?(s(),_(e(xe),{key:0,class:"w-4 text-green-500"})):(s(),_(e(ke),{key:1,class:"w-4"}))])],64)):(s(),n("div",Ye,[a(e(K),{class:"size-4 animate-spin"})]))])])],64))],64))])]),_:1})]),_:1},8,["open"]))}});export{ct as _,ut as a,Q as u};
