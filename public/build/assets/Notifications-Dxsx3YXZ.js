import{r as w,d as me,c as A,o as fe,b as m,e as l,i as r,u as a,w as n,h as s,g as x,a as y,j as f,n as C,t as _,F as K,k as G,l as X,q as ve,v as xe,p as ee}from"./vue-vendor-DmxhFomr.js";import{c as ge}from"./admin-j62zy8g0.js";import{h as be,r as he}from"./inertia-vendor-BXJnWAhq.js";import{K as U,L as H,M as J,O as te,t as E,N as V,a as $}from"./ui-components-Dj0vw2vK.js";import{a as F}from"./vendor-BqPpK9Aj.js";import{u as ye}from"./useToast-Dsd6g505.js";import{u as _e}from"./useFirebaseNotifications-BTsjc3Sb.js";import{k as se,a as we,a8 as ke,ao as Ce,R as Ne,aC as Pe,C as Se,aD as Q,l as $e,m as Fe,T as Te}from"./lucide-vendor-BUHJwLVO.js";import"./utility-vendor-CjxovF-h.js";import"./ui-vendor-B7N-G3Ug.js";import"./leaflet-vendor-Do2TvcFZ.js";import"./toast-vendor-DVSe2vMM.js";function De(){const u=w({supported:"Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window,permission:"Notification"in window?Notification.permission:"denied",subscription:null}),g=()=>u.value.supported,N=()=>u.value.permission==="granted",T=()=>u.value.permission==="denied",P=async()=>{if(!u.value.supported)return console.warn("Push notifications are not supported in this browser"),!1;try{const o=await Notification.requestPermission();return u.value.permission=o,o==="granted"?(console.log("Notification permission granted"),await M(),!0):(console.log("Notification permission denied"),!1)}catch(o){return console.error("Error requesting notification permission:",o),!1}},M=async()=>{if(!u.value.supported||u.value.permission!=="granted")return null;try{const o=await navigator.serviceWorker.ready;let d=await o.pushManager.getSubscription();return d?(u.value.subscription=d,await O(d),d):(console.warn("VAPID public key not configured"),null)}catch(o){return console.error("Error subscribing to push notifications:",o),null}},L=async()=>{if(!u.value.subscription)return!0;try{return await u.value.subscription.unsubscribe(),await k(),u.value.subscription=null,!0}catch(o){return console.error("Error unsubscribing from push notifications:",o),!1}},O=async o=>{try{await F.post("/api/push-subscriptions",{endpoint:o.endpoint,keys:{p256dh:v(o.getKey("p256dh")),auth:v(o.getKey("auth"))}}),console.log("Push subscription saved to server")}catch(d){console.error("Error saving push subscription:",d)}},k=async()=>{try{await F.delete("/api/push-subscriptions"),console.log("Push subscription deleted from server")}catch(o){console.error("Error deleting push subscription:",o)}},D=async()=>{if(!u.value.supported)return null;try{const d=await(await navigator.serviceWorker.ready).pushManager.getSubscription();return u.value.subscription=d,d}catch(o){return console.error("Error checking subscription:",o),null}},W=async(o,d)=>{if(!u.value.supported||u.value.permission!=="granted"){console.warn("Cannot show notification: not supported or permission not granted");return}try{await(await navigator.serviceWorker.ready).showNotification(o,{badge:"/icon-192x192.png",icon:"/icon-192x192.png",vibrate:[200,100,200],...d})}catch(c){console.error("Error showing notification:",c)}};function B(o){const d="=".repeat((4-o.length%4)%4),c=(o+d).replace(/\-/g,"+").replace(/_/g,"/"),p=window.atob(c),b=new Uint8Array(p.length);for(let h=0;h<p.length;++h)b[h]=p.charCodeAt(h);return b}function v(o){if(!o)return"";const d=new Uint8Array(o);let c="";for(let p=0;p<d.byteLength;p++)c+=String.fromCharCode(d[p]);return window.btoa(c)}return{state:u,isSupported:g,isGranted:N,isDenied:T,requestPermission:P,subscribe:M,unsubscribe:L,checkSubscription:D,showNotification:W}}const Ae={class:"py-6 sm:py-8 md:py-12"},Ee={class:"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8"},Me={class:"mb-4 sm:mb-6"},Be={class:"flex items-center justify-between gap-4"},je={class:"flex items-center gap-2"},Re={class:"flex items-center gap-2"},qe=["disabled"],ze={key:0,class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3"},Ke={key:1,class:"text-xs text-destructive p-3 bg-destructive/10 rounded-lg border border-destructive/20"},Ue={key:2,class:"p-3 bg-muted/50 rounded-lg border border-dashed"},Ve={key:0,class:"mb-4 sm:mb-6"},Le={class:"flex items-start gap-3 sm:gap-4"},Oe={class:"flex-1"},We={class:"flex flex-col sm:flex-row gap-2"},Ie={class:"flex flex-col lg:flex-row gap-4 sm:gap-6"},Ge={class:"w-full lg:w-64 flex-shrink-0"},Xe={class:"lg:hidden flex overflow-x-auto gap-2 p-3 scrollbar-hide"},He=["onClick"],Je={class:"relative"},Qe={class:"hidden lg:block"},Ye=["onClick"],Ze={class:"flex items-center gap-3"},et={class:"flex-1"},tt={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4"},st={key:0,class:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-2 sm:gap-3 p-2 sm:p-3 bg-muted/30 rounded-lg border mb-3 sm:mb-4"},it={class:"flex items-center gap-2"},at={class:"flex items-center justify-between sm:justify-start gap-2"},ot=["disabled"],nt={class:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap"},rt=["disabled"],lt={key:1,class:"text-center py-6 sm:py-8 text-xs sm:text-sm text-muted-foreground"},dt={key:2,class:"text-center py-6 sm:py-8 text-muted-foreground"},ct={key:3,class:"space-y-2 sm:space-y-3"},ut=["onClick"],pt={class:"flex gap-2 sm:gap-3 md:gap-4"},mt={class:"flex-1 min-w-0 space-y-1 sm:space-y-2"},ft={class:"flex items-start justify-between gap-2 sm:gap-3 md:gap-4"},vt={class:"flex-1"},xt={class:"text-xs sm:text-sm text-muted-foreground mt-0.5 sm:mt-1"},gt={class:"flex items-center gap-1 sm:gap-2 flex-shrink-0"},bt={class:"text-[10px] sm:text-xs text-muted-foreground"},ht={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2 w-0.5 sm:w-1 h-8 sm:h-12 bg-primary rounded-r"},At=me({__name:"Notifications",props:{initialNotifications:{default:()=>({data:[],current_page:1,last_page:1,per_page:20,total:0})},unreadCount:{default:0}},setup(u){const g=ye(),N=De(),{isSupported:T,permission:P,enableNotifications:M,disableNotifications:L,fcmToken:O}=_e(),k=A(()=>P.value==="granted"&&O.value),D=w(!1),W=async i=>{D.value=!0;try{i?await M():await L()}finally{D.value=!1}},B=u,v=w(B.initialNotifications?.data||[]),o=w(!1),d=w(B.unreadCount||0),c=w("all"),p=w(10),b=w(1),h=[{id:"all",label:"All Notifications",icon:se,types:[]},{id:"pending",label:"Pending Appointments",icon:we,types:["appointment_booked","appointment_confirmed"]},{id:"reviews",label:"New Reviews",icon:ke,types:["review_received","clinic_review_submitted","review_reply"]},{id:"bookings",label:"New Bookings",icon:Ce,types:["appointment_booked"]},{id:"reschedule",label:"Reschedule Requests",icon:Ne,types:["appointment_rescheduled","reschedule_request","follow_up_appointment_rescheduled"]},{id:"cancellations",label:"Cancellation Requests",icon:Pe,types:["appointment_cancelled","cancel_request"]},{id:"reminders",label:"Reminders",icon:Se,types:["appointment_reminder","follow_up_appointment_reminder"]}],j=A(()=>{if(c.value==="all")return v.value;const i=h.find(e=>e.id===c.value);return i?v.value.filter(e=>i.types.some(t=>e.type.includes(t))):v.value}),ie=A(()=>{const i=(b.value-1)*p.value,e=i+p.value;return j.value.slice(i,e)}),I=A(()=>Math.ceil(j.value.length/p.value)),Y=i=>{i>=1&&i<=I.value&&(b.value=i,window.scrollTo({top:0,behavior:"smooth"}))},ae=i=>{p.value=i,b.value=1},R=i=>{if(i==="all")return v.value.filter(t=>!t.is_read).length;const e=h.find(t=>t.id===i);return e?v.value.filter(t=>!t.is_read&&e.types.some(S=>t.type.includes(S))).length:0},oe=A(()=>v.value.some(i=>!i.is_read)),Z=async i=>{if(!i.is_read)try{await F.post(`/notifications/${i.id}/mark-as-read`),i.is_read=!0,i.read_at=new Date().toISOString(),d.value=Math.max(0,d.value-1)}catch(e){console.error("Failed to mark as read:",e)}},ne=async()=>{try{await F.post("/notifications/mark-all-as-read"),v.value.forEach(i=>{i.is_read=!0,i.read_at=new Date().toISOString()}),d.value=0,g.success("All notifications marked as read")}catch(i){console.error("Failed to mark all as read:",i),g.error("Failed to mark all as read")}},re=async i=>{try{await F.delete(`/notifications/${i.id}`),v.value=v.value.filter(e=>e.id!==i.id),g.success("Notification deleted")}catch(e){console.error("Failed to delete notification:",e),g.error("Failed to delete notification")}},le=i=>{Z(i),i.data?.appointment_id&&he.visit(`/appointments/${i.data.appointment_id}`)},de=i=>new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),q=w(!1);fe(()=>{N.isSupported()&&!N.isGranted()&&!N.isDenied()&&(q.value=!0),N.checkSubscription()});const ce=async()=>{await N.requestPermission()?(g.success("Push notifications enabled successfully"),q.value=!1):g.error("Failed to enable push notifications")},ue=()=>{q.value=!1},z=w(!1),pe=async()=>{z.value=!0;try{const i=await F.post("/api/notifications/send",{title:"Test Notification",body:"This is a test push notification from PetConnect! ðŸ¾",data:{type:"test",timestamp:new Date().toISOString()},priority:"high"});i.data.success?g.success("Test notification sent successfully! Check your device."):g.error(i.data.message||"Failed to send test notification")}catch(i){console.error("Failed to send test notification:",i),g.error(i.response?.data?.message||"Failed to send test notification")}finally{z.value=!1}};return(i,e)=>(l(),m(K,null,[r(a(be),{title:"Notifications"}),r(ge,null,{default:n(()=>[s("div",Ae,[s("div",Ee,[s("div",Me,[r(a(U),null,{default:n(()=>[r(a(H),{class:"p-4 sm:p-6"},{default:n(()=>[s("div",Be,[s("div",je,[r(a(Q),{class:"h-5 w-5 text-primary"}),s("div",null,[r(a(J),{class:"text-base sm:text-lg"},{default:n(()=>[...e[5]||(e[5]=[f("Push Notification Settings",-1)])]),_:1}),r(a(te),{class:"text-xs sm:text-sm mt-0.5"},{default:n(()=>[...e[6]||(e[6]=[f(" Manage your notification preferences ",-1)])]),_:1})])]),s("div",Re,[k.value?(l(),y(a(E),{key:0,variant:"default",class:"text-xs"},{default:n(()=>[...e[7]||(e[7]=[f(" Active ",-1)])]),_:1})):a(P)==="denied"?(l(),y(a(E),{key:1,variant:"destructive",class:"text-xs"},{default:n(()=>[...e[8]||(e[8]=[f(" Blocked ",-1)])]),_:1})):x("",!0),s("button",{onClick:e[0]||(e[0]=t=>W(!k.value)),disabled:!a(T)||a(P)==="denied"||D.value,class:C(["relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",k.value?"bg-primary":"bg-input"])},[s("span",{class:C(["pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",k.value?"translate-x-5":"translate-x-0"])},null,2)],10,qe)])])]),_:1}),a(P)==="denied"||!a(T)||k.value?(l(),y(a(V),{key:0,class:"p-4 sm:p-6 pt-0 space-y-4"},{default:n(()=>[k.value?(l(),m("div",ze,[r(a($),{onClick:pe,disabled:z.value,variant:"outline",size:"sm",class:"w-full sm:w-auto text-xs sm:text-sm"},{default:n(()=>[r(a(Q),{class:"h-4 w-4 mr-2"}),f(" "+_(z.value?"Sending...":"Send Test Notification"),1)]),_:1},8,["disabled"]),e[9]||(e[9]=s("p",{class:"text-xs text-muted-foreground"}," Click to send a test push notification to this device ",-1))])):x("",!0),a(P)==="denied"?(l(),m("div",Ke," âš ï¸ Please enable notifications in your browser settings ")):a(T)?x("",!0):(l(),m("div",Ue,[...e[10]||(e[10]=[s("p",{class:"text-xs text-muted-foreground"}," âš ï¸ Push notifications are not supported in your current browser. Try Chrome, Firefox, or Edge. ",-1)])]))]),_:1})):x("",!0)]),_:1})]),q.value?(l(),m("div",Ve,[r(a(U),{class:"border-primary/50 bg-primary/5"},{default:n(()=>[r(a(V),{class:"p-4 sm:p-6"},{default:n(()=>[s("div",Le,[r(a(Q),{class:"h-5 w-5 sm:h-6 sm:w-6 text-primary flex-shrink-0 mt-0.5"}),s("div",Oe,[e[13]||(e[13]=s("h3",{class:"font-semibold text-sm sm:text-base mb-1"},"Enable Push Notifications",-1)),e[14]||(e[14]=s("p",{class:"text-xs sm:text-sm text-muted-foreground mb-3 sm:mb-4"}," Stay updated with instant notifications for appointments, reminders, and important updates. ",-1)),s("div",We,[r(a($),{onClick:ce,size:"sm",class:"text-xs sm:text-sm"},{default:n(()=>[...e[11]||(e[11]=[f(" Enable Notifications ",-1)])]),_:1}),r(a($),{onClick:ue,variant:"ghost",size:"sm",class:"text-xs sm:text-sm"},{default:n(()=>[...e[12]||(e[12]=[f(" Maybe Later ",-1)])]),_:1})])])])]),_:1})]),_:1})])):x("",!0),s("div",Ie,[s("div",Ge,[r(a(U),null,{default:n(()=>[r(a(H),{class:"p-4 sm:p-6 lg:block hidden"},{default:n(()=>[r(a(J),{class:"text-base sm:text-lg"},{default:n(()=>[...e[15]||(e[15]=[f("Categories",-1)])]),_:1})]),_:1}),r(a(V),{class:"p-0"},{default:n(()=>[s("nav",Xe,[(l(),m(K,null,G(h,t=>s("button",{key:t.id,onClick:S=>c.value=t.id,class:C(["relative flex-shrink-0 flex flex-col items-center justify-center p-3 rounded-lg transition-colors hover:bg-accent/50",c.value===t.id?"bg-accent text-accent-foreground border-2 border-primary":"text-muted-foreground hover:text-foreground border-2 border-transparent"])},[s("div",Je,[(l(),y(X(t.icon),{class:C(["h-6 w-6",c.value===t.id?"text-primary":""])},null,8,["class"])),R(t.id)>0?(l(),y(a(E),{key:0,variant:"destructive",class:"absolute -top-2 -right-2 h-5 min-w-5 px-1 flex items-center justify-center text-xs rounded-full"},{default:n(()=>[f(_(R(t.id)),1)]),_:2},1024)):x("",!0)])],10,He)),64))]),s("nav",Qe,[(l(),m(K,null,G(h,t=>s("button",{key:t.id,onClick:S=>c.value=t.id,class:C(["w-full flex items-center justify-between px-4 py-3 text-sm font-medium transition-colors hover:bg-accent/50",c.value===t.id?"bg-accent text-accent-foreground border-l-4 border-primary":"text-muted-foreground hover:text-foreground"])},[s("div",Ze,[(l(),y(X(t.icon),{class:C(["h-4 w-4",c.value===t.id?"text-primary":""])},null,8,["class"])),s("span",null,_(t.label),1)]),R(t.id)>0?(l(),y(a(E),{key:0,variant:"default",class:"ml-auto text-xs"},{default:n(()=>[f(_(R(t.id)),1)]),_:2},1024)):x("",!0)],10,Ye)),64))])]),_:1})]),_:1})]),s("div",et,[r(a(U),null,{default:n(()=>[r(a(H),{class:"p-3 sm:p-4 md:p-6"},{default:n(()=>[s("div",tt,[s("div",null,[r(a(J),{class:"text-lg sm:text-xl md:text-2xl"},{default:n(()=>[f(_(h.find(t=>t.id===c.value)?.label||"Notifications"),1)]),_:1}),r(a(te),{class:"text-xs sm:text-sm"},{default:n(()=>[...e[16]||(e[16]=[f("Stay updated with your appointments and activities",-1)])]),_:1})]),oe.value?(l(),y(a($),{key:0,onClick:ne,variant:"outline",size:"sm",class:"w-full sm:w-auto text-xs sm:text-sm"},{default:n(()=>[r(a($e),{class:"h-3.5 w-3.5 sm:h-4 sm:w-4 mr-2"}),e[17]||(e[17]=f(" Mark all as read ",-1))]),_:1})):x("",!0)])]),_:1}),r(a(V),{class:"p-3 sm:p-4 md:p-6"},{default:n(()=>[j.value.length>0?(l(),m("div",st,[s("div",it,[e[19]||(e[19]=s("span",{class:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap"},"Show:",-1)),ve(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),onChange:e[2]||(e[2]=t=>ae(p.value)),class:"flex-1 sm:flex-none px-2 sm:px-3 py-1.5 sm:py-1 border rounded-md bg-background text-xs sm:text-sm"},[...e[18]||(e[18]=[s("option",{value:10},"10 per page",-1),s("option",{value:50},"50 per page",-1),s("option",{value:100},"100 per page",-1)])],544),[[xe,p.value]])]),s("div",at,[s("button",{onClick:e[3]||(e[3]=t=>Y(b.value-1)),disabled:b.value===1,class:"flex-1 sm:flex-none px-2 sm:px-3 py-1.5 sm:py-1 border rounded-md hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed text-xs sm:text-sm font-medium"}," Previous ",8,ot),s("span",nt," Page "+_(b.value)+" of "+_(I.value),1),s("button",{onClick:e[4]||(e[4]=t=>Y(b.value+1)),disabled:b.value===I.value,class:"flex-1 sm:flex-none px-2 sm:px-3 py-1.5 sm:py-1 border rounded-md hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed text-xs sm:text-sm font-medium"}," Next ",8,rt)])])):x("",!0),o.value?(l(),m("div",lt," Loading notifications... ")):j.value.length===0?(l(),m("div",dt,[(l(),y(X(h.find(t=>t.id===c.value)?.icon||a(se)),{class:"h-10 w-10 sm:h-12 sm:w-12 mx-auto mb-2 sm:mb-3 opacity-50"})),e[20]||(e[20]=s("p",{class:"text-xs sm:text-sm"},"No notifications in this category",-1))])):(l(),m("div",ct,[(l(!0),m(K,null,G(ie.value,t=>(l(),m("div",{key:t.id,class:C(["relative p-3 sm:p-4 border rounded-lg transition-colors hover:bg-accent/50 cursor-pointer group",{"bg-accent/20 border-primary/20":!t.is_read}]),onClick:S=>le(t)},[s("div",pt,[s("div",mt,[s("div",ft,[s("div",vt,[s("h3",{class:C(["font-semibold text-sm sm:text-base",t.is_read?"text-muted-foreground":"text-foreground"])},_(t.title),3),s("p",xt,_(t.message),1)]),s("div",gt,[t.is_read?x("",!0):(l(),y(a(E),{key:0,variant:"default",class:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5"},{default:n(()=>[...e[21]||(e[21]=[f("New",-1)])]),_:1})),t.is_read?x("",!0):(l(),y(a($),{key:1,variant:"ghost",size:"icon",class:"h-7 w-7 sm:h-8 sm:w-8 opacity-100 sm:opacity-0 group-hover:opacity-100",onClick:ee(S=>Z(t),["stop"])},{default:n(()=>[r(a(Fe),{class:"h-3.5 w-3.5 sm:h-4 sm:w-4"})]),_:1},8,["onClick"])),r(a($),{variant:"ghost",size:"icon",class:"h-7 w-7 sm:h-8 sm:w-8 opacity-100 sm:opacity-0 group-hover:opacity-100",onClick:ee(S=>re(t),["stop"])},{default:n(()=>[r(a(Te),{class:"h-3.5 w-3.5 sm:h-4 sm:w-4"})]),_:1},8,["onClick"])])]),s("div",bt,_(de(t.created_at)),1)])]),t.is_read?x("",!0):(l(),m("div",ht))],10,ut))),128))]))]),_:1})]),_:1})])])])])]),_:1})],64))}});export{At as default};
